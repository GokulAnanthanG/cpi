<!-- SSB Course Plan And Implementation -->
<!--
    ****************
    G.GOKUL ANANTHAN
    ****************
UNDER THE GUIDANCE OF
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    MR.Ashok Lingam Sir  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSB course plan and implementation</title>
    <link rel="stylesheet" href="assets/css/getCpi.css">
    <link rel="shortcut icon" href="assets/img/favicon.ico" type="image/x-icon">
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
        integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
</head>

<body>
    <header>
        <nav>
            <div class="box">
                <div class="box1"><img src="assets/img/logo2.png" class="img-fluid" alt=""></div>
                <div class="box2"><a href="index.html"><button title="home" class="btn"><i
                                class="fa fa-home"></i></button></a>&nbsp; <button id="view" class="btn" title="cpi"><i
                            class="fa fa-eye"></i></button> </div>
            </div>
        </nav>
    </header>
    <br>
    <main>
        <form id="frm">
            <table id="report-table" class="table  table-bordered">
                <thead>
                    <tr>
                        <td align="center" colspan="9">SRI SANKARA BHAGAVATHI ARTS AND SCIENCE COLLEGE,
                            KOMMADIKOTTAI
                        </td>

                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td align="center" colspan="9">Course plan and Implementaion</td>

                    </tr>
                    <tr>
                        <th>Course:</th>
                        <td id="course"> </td>
                        <td></td>
                        <th>Programme:</th>
                        <td id="programme"></td>
                        <td colspan="4"></td>

                    </tr>
                    <tr>
                        <th>Code:</th>
                        <td id="code"> </td>
                        <td></td>
                        <th>Batch:</th>
                        <td id="batch"></td>
                        <td colspan="4"></td>

                    </tr>
                    <tr>
                        <th>Type:</th>
                        <td id="type"> </td>
                        <td></td>
                        <th>Hrs/Week:</th>
                        <td id="hrs_week"></td>
                        <td colspan="4"></td>

                    </tr>
                    <tr>
                        <th>Teacher:</th>
                        <td id="teacher"> </td>
                        <td></td>
                        <th>Credit:</th>
                        <td id="credit"></td>
                        <td colspan="4"></td>

                    </tr>
                    <tr>
                        <th>Sem:</th>
                        <td id="sem"> </td>
                        <td></td>
                        <th>No Of Students:</th>
                        <td id="noOfStudents"></td>
                        <td colspan="4"></td>

                    </tr>

                    <tr>
                        <td>COURSE OUTCOMES :</td>
                        <td colspan="8"></td>
                    </tr>
                <tbody id="co"></tbody>
                <tr>
                    <td colspan="3">Course Plan</td>

                    <td colspan="6">Course Implementation</td>
                </tr>

                <tr>
                    <th>S.NO</th>
                    <th>TOPIC</th>
                    <th>NO OF HRS</th>
                    <th>DATE</th>
                    <th>PERIOD</th>
                    <th>METHODOLOGY AND ACTIVITIES</th>
                    <th>ICT TOOLS USED</th>
                    <th>CONTINUOUS ASSESSMENT TYPE USED</th>
                    <th>REMARK</th>
                </tr>
                <tbody id="cpi"></tbody>
                <tr>
                <tr>
                    <td></td>
                    <td>TOTAL HOURS ALLOTTED = </td>
                    <td><input id="THA" name="THA" type="text"></td>
                    <td colspan="7"></td>
                </tr>
                <tr>
                    <td></td>
                    <td>TOTAL HOURS PLANNED = </td>
                    <td><input id="THP" name="THP" type="text"></td>
                    <td colspan="7"> </td>
                </tr>
                <tr>
                    <td></td>
                    <td>TOTAL HOURS TAKEN = </td>
                    <td><input id="THT" name="THT" type="text"></td>
                    <td colspan="7">
                        <button type="button" id="update" class="btn btn-success"><span id="btnText">update</span><span
                                class="spinner spinner-border"></span></button>
                        <button type="button" id="reset" class="btn btn-primary">reset</button>
                    </td>

                </tr>
                </tr>
                </tbody>
            </table>
        </form>
    </main>
    <!-- #region -->

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <img src="assets/img/favicon.ico" class="img-fluid rounded me-2" alt="...">
                <strong class="me-auto">SSB</strong>
                <small>info</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                Hello, world! This is a ssb message.
            </div>
        </div>
    </div>
    <!-- #endregion -->

    <footer>
        <p align="center">Â© Sri Sankara Bhagavthi Arts & Science College. All Rights Reserved</p>
    </footer>
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
        crossorigin="anonymous"></script>
    <!--jq-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!--tabletoexcel-->
    <script src="https://cdn.rawgit.com/rainabba/jquery-table2excel/1.1.0/dist/jquery.table2excel.min.js"></script>
    <!--tabletopdf-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"
        integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>

    </script>

    <script>
        $(document).ready(() => {
            $(".spinner").fadeOut();
            var param = new window.URLSearchParams(window.location.search);


            $.ajax({
                type: "post",
                url: "./php/getCpi.php",
                data: { code: param.get("code"), batch: param.get("batch") },
                success: (d) => {
                    if (Number(d) !== 0) {
                        let data = JSON.parse(d);
                        $("#course").html(data[0]);
                        $("#code").html(data[1]);
                        $("#type").html(data[2]);
                        $("#teacher").html(data[3]);
                        $("#sem").html(data[4]);
                        $("#programme").html(data[5]);
                        $("#batch").html(data[6]);
                        $("#hrs_week").html(data[7]);
                        $("#credit").html(data[8]);
                        $("#noOfStudents").html(data[9]);
                        $("#THA").val(data[data.length - 3]);
                        $("#THP").val(data[data.length - 2]);
                        $("#THT").val(data[data.length - 1]);
                        console.log(data);
                        data[17].forEach((co, i) => {
                            $("#co").append(`<tr><td>co${i + 1}</td><td colspan="7">${co}<td><tr>`);
                        });
                        data[10].forEach((e, i) => {
                            $("#cpi").append(`
                            <tr><td>${i + 1}</td><td>${e}</td><td>1</td><td><input name='date' type='text' value='${data[11][i]}'</td>
                            <td><input name='period' type='text' value='${data[12][i]}'></td>
                            <td><input name='method' type='text' value='${data[13][i]}'></td>
                            <td><input name='ict' type='text' value='${data[14][i]}'></td>
                            <td><input name='cau' type='text' value='${data[15][i]}'></td>
                            <td><input name='remark' type='text' value='${data[16][i]}'></td>
                                </tr>
                                
                            `)
                        })
                    }
                    else {
                        $(".toast-body").html("oops failed to get cpi :(");
                        $("#liveToast").toast("show");
                        setTimeout(() => { window.location.replace("index.html") }, 2000)
                    }
                },
                error: (err) => {
                    console.log(err); $(".toast-body").html("oops something went wrong :( try again later")
                    $("#liveToast").toast("show")
                }
            });



            $("#update").click(() => {
                if (confirm("Are you sure want to update?")) {
                    $(".spinner").fadeIn();
                    $("#btnText").fadeOut();
                    let date = [];
                    let period = [];
                    let method = [];
                    let ict = [];
                    let cau = [];
                    let remark = [];

                    let data = $("#frm").serializeArray();
                    let length = $("#frm").serializeArray().length;
                    //date
                    for (let itration = 0; itration < length; itration += 6) {
                        date.push(data[itration].value);
                    }
                    //date
                    //period
                    for (let itration = 1; itration < length; itration += 6) {
                        period.push(data[itration].value);
                    }
                    //period
                    //method
                    for (let itration = 2; itration < length; itration += 6) {
                        method.push(data[itration].value);
                    }
                    //method
                    //ict
                    for (let itration = 3; itration < length; itration += 6) {
                        ict.push(data[itration].value);
                    }
                    //ict
                    //cau
                    for (let itration = 4; itration < length; itration += 6) {
                        cau.push(data[itration].value);
                    }
                    //cau
                    //remark
                    for (let itration = 5; itration < length; itration += 6) {
                        remark.push(data[itration].value);
                    }
                    //remark
                    //
                    date.pop();
                    period.pop();
                    method.pop();
                    let THA = data[length - 3].value;
                    let THP = data[length - 2].value;
                    let THT = data[length - 1].value;
                    $.ajax({
                        type: "post",
                        url: "./php/updateCpi.php",
                        data: { batch: param.get("batch"), code: param.get("code"), date: date, period: period, method: method, ict: ict, cau: cau, remark: remark, THA: THA, THP: THP, THT: THT },
                        success: (d) => {
                            $(".spinner").fadeOut();
                            $("#btnText").fadeIn();
                            if (Number(d) == 1) {
                                $(".toast-body").html(`Course plan and Implementaion updated successfully for batch ${param.get("batch")} code:${param.get("code")} `)
                                $("#liveToast").toast("show");
                                setTimeout(() => { location.reload() }, 3000)
                            }
                            else {
                                console.log(err); $(".toast-body").html("oops something went wrong :( try again later")
                                $("#liveToast").toast("show")
                            }
                        },
                        error: (err) => {
                            console.log(err);
                            console.log(err); $(".toast-body").html("oops something went wrong :( try again later")
                            $("#liveToast").toast("show")
                        }
                    })
                }
            })

            $("#reset").click(() => {
                if (confirm("Are you sure ?")) {
                    location.replace(`getCpi.html?batch=${param.get("batch")}&code=${param.get("code")}`);
                }
            })
            $("#view").click(() => {
                location.replace(`viewCpi.html?batch=${param.get("batch")}&code=${param.get("code")}`);

            })
        });
    </script>
</body>

</html>